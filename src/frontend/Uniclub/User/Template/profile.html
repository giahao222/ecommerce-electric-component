<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Profile - VoltEdge</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="bg-gray-100 font-sans">

  <!-- Navbar -->
  <header class="w-full bg-white shadow-sm py-4 px-10 flex justify-between items-center fixed top-0 z-50">
    <div class="flex items-center gap-2 text-xl font-bold">
      <img src="/prepared-clam.10web.cloud/wp-content/uploads/2025/11/logo_LgIYgdxd.svg" class="w-8 h-8" alt="">
      VoltEdge
    </div>
    <nav class="flex gap-8 text-gray-700 font-medium hidden md:flex">
      <a href="/category/laptops" class="hover:text-black">Laptops</a>
      <a href="/category/desktops" class="hover:text-black">Desktops</a>
      <a href="/category/components" class="hover:text-black">Components</a>
      
    </nav>
    <div class="flex items-center gap-4">
     
      
    </div>
  </header>

  <!-- Main Profile Section -->
  <section class="pt-32 pb-20 px-6 md:px-16">
    <div class="max-w-5xl mx-auto grid md:grid-cols-3 gap-10">

      <!-- Left Profile Card -->
      <div class="bg-white shadow-lg rounded-2xl p-8 text-center">
        <img id="profileAvatar"
             src="https://www.svgrepo.com/show/522670/user-circle.svg"
             class="w-32 h-32 mx-auto mb-4 rounded-full object-cover border" />

        <h2 id="user_name" class="text-2xl font-bold">Loading...</h2>
        <p id="profileRole" class="text-gray-500 text-sm mt-1">User Member</p>

          <a class="elementor-icon" id="loginLink" href="" style="display: none;">
                                                  <svg aria-hidden="true" class="e-font-icon-svg e-fas-user-alt"
                                                        viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z">
                                                        </path>
                                                  </svg>
                                            </a>
              
                                      <!-- Hiển thị khi ĐÃ đăng nhập -->
                                      <div id="userSection" style="display: none; align-items: center; gap: 10px;">
                                            <svg aria-hidden="true" class="e-font-icon-svg e-fas-user-alt"
                                                  viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" 
                                                  style="width: 20px; height: 20px; fill: white;">
                                                  <path d="M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z">
                                                  </path>
                                            </svg>
                                            <!-- <span id="user_name" style="color: white; font-weight: 500;"></span> -->
                                      
                                      </div>

        <div class="mt-6 text-left space-y-3">
          <p class="text-gray-700 break-all"><strong>Email:</strong> <span id="profileEmail"></span></p>
          <p class="text-gray-700"><strong>Số điện thoại:</strong> <span id="profilePhone">—</span></p>
          <p class="text-gray-700"><strong>Địa chỉ:</strong> <span id="profileAddress">—</span></p>
          <!-- <p class="text-gray-700"><strong>Ngày tham gia:</strong> <span id="profileJoinDate">—</span></p> -->
        </div>

        <button id="editProfileBtn"
                class="w-full bg-black text-white py-2 mt-6 rounded-xl hover:bg-gray-900 transition">
          Chỉnh sửa hồ sơ
        </button>
      </div>

      <!-- RIGHT CONTENT (Your layout kept same) -->
      <div class="md:col-span-2 space-y-8">

        <!-- Recent Orders -->
        <div class="bg-white shadow-lg rounded-2xl p-8">
          <h3 class="text-xl font-bold mb-4">Đơn hàng gần đây</h3>
          <p class="text-gray-500 text-sm">Tính năng đang cập nhật…</p>
        </div>

        <!-- Settings -->
        <div class="bg-white shadow-lg rounded-2xl p-8">
          <h3 class="text-xl font-bold mb-4">Cài đặt tài khoản</h3>

          <div class="space-y-4">
            <button class="w-full text-left px-4 py-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition font-medium">Đổi mật khẩu</button>
            <button class="w-full text-left px-4 py-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition font-medium">Quản lý địa chỉ</button>
            <button class="w-full text-left px-4 py-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition font-medium">Phương thức thanh toán</button>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- Modal Edit Profile -->
  <div id="editProfileModal"
       class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
    <div class="bg-white p-8 rounded-2xl w-full max-w-lg shadow-xl relative">

      <h2 class="text-2xl font-bold mb-6 text-center">Chỉnh sửa hồ sơ</h2>

      <!-- Avatar preview -->
      <div class="flex flex-col items-center mb-6">
        <img id="previewAvatar"
             src="https://www.svgrepo.com/show/522670/user-circle.svg"
             class="w-28 h-28 rounded-full object-cover border" />
        <input type="file" id="avatarInput" class="mt-3" accept="image/*">
      </div>

      <div class="space-y-4">
        <div>
          <label class="font-medium">Họ và tên</label>
          <input id="fullNameInput" 
                 type="text" 
                 class="w-full mt-1 p-3 rounded-lg border bg-gray-50 focus:bg-white focus:ring-2" />
        </div>

        <div>
          <label class="font-medium">Số điện thoại</label>
          <input id="phoneInput" 
                 type="text" 
                 class="w-full mt-1 p-3 rounded-lg border bg-gray-50 focus:bg-white focus:ring-2" />
        </div>

        <div>
          <label class="font-medium">Địa chỉ</label>
          <input id="addressInput" 
                 type="text" 
                 class="w-full mt-1 p-3 rounded-lg border bg-gray-50 focus:bg-white focus:ring-2" />
        </div>
      </div>

      <div class="flex justify-end gap-3 mt-8">
        <button id="cancelEditBtn"
                class="px-4 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500">
          Hủy
        </button>

        <button id="saveProfileBtn"
                class="px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-900">
          Lưu thay đổi
        </button>
      </div>
    </div>
  </div>

  <!-- Load User Data + Modal Logic -->
  <script>
    // async function loadProfile() {
    //   const res = await fetch("/profile", {
    //     headers: { Authorization: `Bearer ${localStorage.getItem("accessToken")}` }
    //   });

    //   const json = await res.json();
    //   const user = json.data;

    //   document.getElementById("profileName").innerText = user.full_name;
    //   document.getElementById("profileEmail").innerText = user.email || "-";
    //   document.getElementById("profilePhone").innerText = user.phone_number || "—";
    //   document.getElementById("profileAddress").innerText = user.address || "—";
    //   document.getElementById("profileRole").innerText = user.role;
    //   document.getElementById("profileJoinDate").innerText = new Date(user.createdAt).toLocaleDateString("vi-VN");

    //   document.getElementById("profileAvatar").src =
    //     user.image || "https://www.svgrepo.com/show/522670/user-circle.svg";

    //   document.getElementById("headerUserName").innerHTML = `
    //     <img src="${user.image || "https://www.svgrepo.com/show/522670/user-circle.svg"}" class="w-5 h-5 rounded-full" />
    //     ${user.full_name}
    //   `;
    // }

    loadProfile();

  //   // Modal logic
  //   const modal = document.getElementById("editProfileModal");
  //   const editBtn = document.getElementById("editProfileBtn");
  //   const cancelBtn = document.getElementById("cancelEditBtn");

  //   const previewAvatar = document.getElementById("previewAvatar");
  //   const avatarInput = document.getElementById("avatarInput");

  //   const fullNameInput = document.getElementById("fullNameInput");
  //   const phoneInput = document.getElementById("phoneInput");
  //   const addressInput = document.getElementById("addressInput");
  //   const saveBtn = document.getElementById("saveProfileBtn");

  //   editBtn.addEventListener("click", async () => {
  //     modal.classList.remove("hidden");

  //     const res = await fetch("/profile", {
  //       headers: { Authorization: `Bearer ${localStorage.getItem("accessToken")}` }
  //     });
  //     const json = await res.json();
  //     const user = json.data;

  //     fullNameInput.value = user.full_name;
  //     phoneInput.value = user.phone_number || "";
  //     addressInput.value = user.address || "";
  //     previewAvatar.src = user.image || "https://www.svgrepo.com/show/522670/user-circle.svg";
  //   });

  //   cancelBtn.addEventListener("click", () => {
  //     modal.classList.add("hidden");
  //   });

  //   avatarInput.addEventListener("change", (e) => {
  //     const file = e.target.files[0];
  //     if (file) previewAvatar.src = URL.createObjectURL(file);
  //   });

  //   saveBtn.addEventListener("click", async () => {
  //     const form = new FormData();
  //     form.append("full_name", fullNameInput.value);
  //     form.append("phone_number", phoneInput.value);
  //     form.append("address", addressInput.value);

  //     if (avatarInput.files.length > 0) {
  //       form.append("image", avatarInput.files[0]);
  //     }

  //     const res = await fetch("/api/users/profile", {
  //       method: "PUT",
  //       headers: { Authorization: `Bearer ${localStorage.getItem("accessToken")}` },
  //       body: form,
  //     });

  //     const json = await res.json();

  //     if (json.message === "Cập nhật thông tin thành công!") {
  //       alert("Cập nhật hồ sơ thành công!");
  //       location.reload();
  //     } else {
  //       alert("Lỗi cập nhật hồ sơ!");
  //     }
  //   });
  // </script>
   <script>
  // Hàm kiểm tra và hiển thị thông tin user
  async function loadUserInfo() {
    const token = localStorage.getItem('token');
    const loginLink = document.getElementById('loginLink');
    const userSection = document.getElementById('userSection');
    const userNameElement = document.getElementById('user_name');
    
    // Nếu không có token, hiển thị link login
    if (!token) {
      console.log('No token found, showing login link');
      loginLink.style.display = 'inline-block';
      userSection.style.display = 'none';
      return;
    }

    try {
      // Gọi API để lấy thông tin user
      const response = await fetch('/profile', {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });

      if (!response.ok) {
        // Token hết hạn hoặc không hợp lệ
        if (response.status === 401) {
          console.log('Token expired or invalid');
          localStorage.removeItem('token');
          localStorage.removeItem('user');
          loginLink.style.display = 'inline-block';
          userSection.style.display = 'none';
          return;
        }
        throw new Error('Failed to fetch profile');
      }

      const data = await response.json();
      console.log("API /profile trả về:", data);
      if (data.success && data.user) {
        // Hiển thị section user và ẩn link login
        loginLink.style.display = 'none';
        userSection.style.display = 'flex';
        
        
        // Hiển thị tên user
        userNameElement.textContent = `${data.user.full_name}`;
        
        document.getElementById("profileEmail").innerText = data.user.email || "Chưa cập nhật";
        document.getElementById("profilePhone").innerText = data.user.phone_number || "Chưa cập nhật";
        document.getElementById("profileAddress").innerText = data.user.address || "Chưa cập nhật";
        document.getElementById("profileJoinDate").innerText =
        new Date(data.user.createdAt).toLocaleDateString("vi-VN");
        console.log(data.user.createdAt)
      
        document.getElementById("profileAvatar").src =
          data.user.image || "/images/User/useDefault.png";

          // Lưu lại user info
          localStorage.setItem('user', JSON.stringify(data.user));
          
          console.log('User loaded successfully:', data.user.full_name);
      }
    } catch (error) {
      console.error('Error loading user info:', error);
      // Nếu có lỗi, hiển thị link login
      loginLink.style.display = 'inline-block';
      userSection.style.display = 'none';
    }
  }

  // Gọi hàm khi trang load xong
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadUserInfo);
  } else {
    loadUserInfo();
  }
</script>

</body>
</html>
